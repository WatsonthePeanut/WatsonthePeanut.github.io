<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>哈希表（Hash Tables） | 夢よ未来へ</title><meta name="author" content="WatsonthePeanut"><meta name="copyright" content="WatsonthePeanut"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="这一节我认为 Josh Hug 讲得更清楚，所以这一节是基于 sp23 的。 PPT 链接  之前我们已经见过了集合与映射的几种实现：  但我们目前的方式仍有一些缺陷：  键值必须是可比较的。  像我们在 lab7 中实现的 BSTMap，K 必须要 extends Comparable&lt;K&gt;。我们需要问一些像“X 比 Y 小吗？”这样的问题，但它并不适用于所有的类型。如果我们有一些">
<meta property="og:type" content="article">
<meta property="og:title" content="哈希表（Hash Tables）">
<meta property="og:url" content="http://example.com/2025/08/14/Hashing/index.html">
<meta property="og:site_name" content="夢よ未来へ">
<meta property="og:description" content="这一节我认为 Josh Hug 讲得更清楚，所以这一节是基于 sp23 的。 PPT 链接  之前我们已经见过了集合与映射的几种实现：  但我们目前的方式仍有一些缺陷：  键值必须是可比较的。  像我们在 lab7 中实现的 BSTMap，K 必须要 extends Comparable&lt;K&gt;。我们需要问一些像“X 比 Y 小吗？”这样的问题，但它并不适用于所有的类型。如果我们有一些">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/HashingPost/0.0.png">
<meta property="article:published_time" content="2025-08-14T02:58:55.000Z">
<meta property="article:modified_time" content="2025-08-18T07:24:47.831Z">
<meta property="article:author" content="WatsonthePeanut">
<meta property="article:tag" content="Data Structure">
<meta property="article:tag" content="CS61B">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/HashingPost/0.0.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "哈希表（Hash Tables）",
  "url": "http://example.com/2025/08/14/Hashing/",
  "image": "http://example.com/img/HashingPost/0.0.png",
  "datePublished": "2025-08-14T02:58:55.000Z",
  "dateModified": "2025-08-18T07:24:47.831Z",
  "author": [
    {
      "@type": "Person",
      "name": "WatsonthePeanut",
      "url": "https://github.com/WatsonthePeanut"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.ico"><link rel="canonical" href="http://example.com/2025/08/14/Hashing/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":200,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":150,"languages":{"author":"作者: WatsonthePeanut","link":"链接: ","source":"来源: 夢よ未来へ","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: true,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '哈希表（Hash Tables）',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg" style="background-image: url(/img/background.jpg);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">12</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">4</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-heart"></i><span> Miku</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-image"></i><span> 图库</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-circle-info"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/HashingPost/0.0.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">夢よ未来へ</span></a><a class="nav-page-title" href="/"><span class="site-name">哈希表（Hash Tables）</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-heart"></i><span> Miku</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-image"></i><span> 图库</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-circle-info"></i><span> 关于</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">哈希表（Hash Tables）</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon far fa-calendar-alt"></i><span class="post-meta-label">发表于</span><time datetime="2025-08-14T02:58:55.000Z" title="发表于 2025-08-14 10:58:55">2025-08-14</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">6.1k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>21分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><blockquote>
<p>这一节我认为 Josh Hug 讲得更清楚，所以这一节是基于 sp23 的。<br>
<a target="_blank" rel="noopener" href="https://docs.google.com/presentation/d/1ugoQ4Ni0SrmMToiXmGyRZUueqiYBWeM1E78geVmyFW4/edit?slide=id.g1f6a0dff07b_0_1266#slide=id.g1f6a0dff07b_0_1266">PPT 链接</a></p>
</blockquote>
<p>之前我们已经见过了集合与映射的几种实现：</p>
<p><img src="/img/HashingPost/0.1.jpg" alt=""></p>
<p>但我们目前的方式仍有一些缺陷：</p>
<ul>
<li>键值必须是可比较的。
<ul>
<li>像我们在 lab7 中实现的 BSTMap，K 必须要 <code>extends Comparable&lt;K&gt;</code>。我们需要问一些像“X 比 Y 小吗？”这样的问题，但它并不适用于所有的类型。如果我们有一些像对象、狗狗照片之类的东西，这些东西是没法比较的。</li>
</ul>
</li>
<li>目前基于搜索树的集合（映射）实现的性能很好，但能不能做得更好？
<ul>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">Θ</mi><mo stretchy="false">(</mo><mi>log</mi><mo>⁡</mo><mi>N</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\Theta(\log N)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">Θ</span><span class="mopen">(</span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mclose">)</span></span></span></span> 很出色，10 亿个节点的树的高度只有 30，但能不能比这更好？</li>
</ul>
</li>
</ul>
<h1>初识哈希表</h1>
<h2 id="哈希表的推导">哈希表的推导</h2>
<h3 id="ArrayOfListsSet">ArrayOfListsSet</h3>
<p>回到我们介绍 BST 时用到的基于单链表的列表：</p>
<p><img src="/img/HashingPost/1.1.jpg" alt=""></p>
<p>此时列表的 <code>contains()</code> 和 <code>add()</code> 方法显而易见是非常慢的。</p>
<p>引入 BST 时我们用到的方法是将列表排好序之后，将列表改造成一个树形结构。</p>
<p>现在我们换一种思路：如果我们不进行排序，而是将我们的列表分裂成两个列表，一个存奇数，一个存偶数。如果元素被平均分配，那么 <code>contains()</code> 和 <code>add()</code> 的速度不就提高了二倍吗？</p>
<p><img src="/img/HashingPost/1.2.jpg" alt=""></p>
<p>假如现在我们有了 10 个列表，对于 [3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15] 这些元素又该如何分配？</p>
<p>没错，只要按照每个元素模 10 后的结果，也就是个位数字进行分配就可以了：</p>
<p><img src="/img/HashingPost/1.3.jpg" alt=""></p>
<p>此时只要保证元素平均分配，我们的速度就提高了 10 倍！</p>
<p>下面是每个元素被分配时的流程。</p>
<p>如果我们一共有 N 个元素，平均分配到 M 个列表中，则每个列表的长度为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mi mathvariant="normal">/</mi><mi>M</mi></mrow><annotation encoding="application/x-tex">N / M</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mord">/</span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span></span></span></span>，且最多可获得 M 倍的速度提升。</p>
<p><img src="/img/HashingPost/1.4.jpg" alt=""></p>
<p>对于这种数据结构，每个列表通常被称作“桶（Bucket）”。</p>
<ul>
<li>桶中的元素数量不定</li>
<li>元素在桶中的分布取决于缩减函数（reduction function）</li>
</ul>
<h3 id="DynamicArrayOfListsSet">DynamicArrayOfListsSet</h3>
<p>不妨让我们的想法更疯狂一些：如果有多少整数（听起来有点怪）我们就有多少个桶，那每个操作岂不是都是 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">Θ</mi><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\Theta(1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">Θ</span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span></span></span></span> 级的速度了吗？</p>
<p><img src="/img/HashingPost/1.5.jpg" alt=""></p>
<p>显而易见，这是一种极其浪费的方法。</p>
<ul>
<li>Java 能表示的整型并非无限，最小的整数是 -2147483648 而最大的整数是 2147483647</li>
<li>这意味着我们不仅需要一个尺寸有 40 多亿的数组，还需要 40 多亿个桶</li>
</ul>
<p>我们能不能在运行时间于内存占用之间做出一些取舍呢？</p>
<p>我们起初将取一个较小的 M 值，随后 M 会随着 N 的增加而增大，类似于我们的动态数组（AList，ArrayDeque）。</p>
<p>现在我们指定一个规则：规定 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mi mathvariant="normal">/</mi><mi>M</mi></mrow><annotation encoding="application/x-tex">N / M</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mord">/</span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span></span></span></span> 为负载因数，当 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mi mathvariant="normal">/</mi><mi>M</mi><mo>≥</mo><mn>1.5</mn></mrow><annotation encoding="application/x-tex">N / M \geq 1.5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mord">/</span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≥</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1.5</span></span></span></span> 时，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi><mo>×</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">M \times 2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span></span></span></span>。</p>
<p>如下图，当我们经过了 <code>add(7)</code>, <code>add(16)</code>, <code>add(3)</code>, <code>add(11)</code>, <code>add(20)</code>, <code>add(13)</code> 后就需要进行一次 <code>resize()</code>：</p>
<p><img src="/img/HashingPost/1.6.jpg" alt="之前已经添加的元素也需要进行重分配"></p>
<p>现在我们的这个数据结构就叫 “DynamicArrayOfListsSet”，与之前一样，只是 M 会随着 N 的增加而增大。如果 N 个元素被平均分配，每个桶的长度大小 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mi mathvariant="normal">/</mi><mi>M</mi></mrow><annotation encoding="application/x-tex">N / M</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mord">/</span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span></span></span></span>。</p>
<ul>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mi mathvariant="normal">/</mi><mi>M</mi></mrow><annotation encoding="application/x-tex">N / M</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mord">/</span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span></span></span></span> 最小时没有元素等于 0，最大能取到 1.5 渐近分析就是常数。所以每个操作的花费平均下来也是常数，显然要比那一堆树要快。</li>
</ul>
<h3 id="小写字符串">小写字符串</h3>
<p>目前我们的数据结构用来存储整数十分合适，接下来让我们看看如何存储字符串吧：</p>
<p>假如我们想要 <code>add(&quot;cat&quot;)</code>，一个分配方案是按照首字母与桶编号进行匹配，如：</p>
<ul>
<li>a = 1, b = 2, c = 3, ···, z = 26</li>
<li>则 “cat” 会进入 3 号桶</li>
</ul>
<p>这个方案的缺点也显而易见：</p>
<ul>
<li>可以进行 <code>resize</code>，但实际派上用场的永远只有前 26 个桶</li>
<li>无法存储 “=98yae98fwyawef” 这种东西</li>
</ul>
<p>我们得换种思路。假如我们将字符串视作一个 26 进制的数字：</p>
<ul>
<li>仍然 a = 1, b = 2, c = 3, ···, z = 26</li>
<li>但 “cat” 对应的十进制数为：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mn>3</mn><mo>×</mo><msup><mn>26</mn><mn>2</mn></msup><mo stretchy="false">)</mo><mo>+</mo><mo stretchy="false">(</mo><mn>1</mn><mo>×</mo><msup><mn>26</mn><mn>1</mn></msup><mo stretchy="false">)</mo><mo>+</mo><mo stretchy="false">(</mo><mn>20</mn><mo>×</mo><msup><mn>26</mn><mn>0</mn></msup><mo stretchy="false">)</mo><mo>=</mo><mn>2074</mn></mrow><annotation encoding="application/x-tex">(3 \times 26^2) + (1 \times 26^1) + (20 \times 26^0) = 2074</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">3</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mord"><span class="mord">6</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mord"><span class="mord">6</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">20</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mord"><span class="mord">6</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2074</span></span></span></span></li>
</ul>
<p>只要我们的底数大于等于 26，就能保证每个小写英语单词都对应一个独一无二的十进制整数！</p>
<p>现在我们就能够处理字符串了：</p>
<ul>
<li>数据首先经由一个整数化函数转换为整数</li>
<li>这个整数再经由缩减函数转换为一个有效的下标插入到对应桶中</li>
</ul>
<p><img src="/img/HashingPost/1.7.jpg" alt=""></p>
<h3 id="整数溢出">整数溢出</h3>
<p>但只对小写英语字母有效未免太严格了，如果我们想存储 “2pac” 或 “eGg!” 该怎么办？</p>
<p>像 26 个字母一样，我们就需要为每一个可能出现的字符分配一个数字匹配。听起来很累，但值得庆幸的是这件事已经有人做过了：</p>
<p>现在大多数计算机使用的最基本的字符集是 ASCII 格式。</p>
<ul>
<li>每个可能的字符都被分配一个介于 0 到 127 之间的值</li>
<li>其中 33 - 126 是“可打印的”，如下图所示</li>
<li><code>char c = 'D'</code> 等价于 <code>char c = 68</code></li>
</ul>
<p><img src="/img/HashingPost/1.8.jpg" alt=""></p>
<p>对于纯英文的文本包含标点符号最大的值为 126，那么就可以以 126 作为底数来保证我们的字符串有唯一的整数与其对应。如：</p>
<ul>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mi>e</mi><msub><mi>e</mi><mn>126</mn></msub><mo>=</mo><mo stretchy="false">(</mo><mn>98</mn><mo>×</mo><msup><mn>126</mn><mn>2</mn></msup><mo stretchy="false">)</mo><mo>+</mo><mo stretchy="false">(</mo><mn>101</mn><mo>×</mo><msup><mn>126</mn><mn>1</mn></msup><mo stretchy="false">)</mo><mo>+</mo><mo stretchy="false">(</mo><mn>101</mn><mo>×</mo><msup><mn>126</mn><mn>0</mn></msup><mo stretchy="false">)</mo><mo>=</mo><mn>1</mn><mo separator="true">,</mo><mn>568</mn><mo separator="true">,</mo><mn>675</mn></mrow><annotation encoding="application/x-tex">bee_{126} = (98 \times 126^2) + (101 \times 126^1) + (101 \times 126^0) = 1,568,675</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord mathnormal">b</span><span class="mord mathnormal">e</span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">126</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">98</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord">12</span><span class="mord"><span class="mord">6</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">101</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord">12</span><span class="mord"><span class="mord">6</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">101</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord">12</span><span class="mord"><span class="mord">6</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8389em;vertical-align:-0.1944em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">568</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">675</span></span></span></span></li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mi>p</mi><mi>a</mi><msub><mi>c</mi><mn>126</mn></msub><mo>=</mo><mo stretchy="false">(</mo><mn>50</mn><mo>×</mo><msup><mn>126</mn><mn>3</mn></msup><mo stretchy="false">)</mo><mo>+</mo><mo stretchy="false">(</mo><mn>112</mn><mo>×</mo><msup><mn>126</mn><mn>2</mn></msup><mo stretchy="false">)</mo><mo>+</mo><mo stretchy="false">(</mo><mn>97</mn><mo>×</mo><msup><mn>126</mn><mn>1</mn></msup><mo stretchy="false">)</mo><mo>+</mo><mo stretchy="false">(</mo><mn>99</mn><mo>×</mo><msup><mn>126</mn><mn>0</mn></msup><mo stretchy="false">)</mo><mo>=</mo><mn>101</mn><mo separator="true">,</mo><mn>809</mn><mo separator="true">,</mo><mn>233</mn></mrow><annotation encoding="application/x-tex">2pac_{126} = (50 \times 126^3) + (112 \times 126^2) + (97 \times 126^1) + (99 \times 126^0) = 101,809,233</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8389em;vertical-align:-0.1944em;"></span><span class="mord">2</span><span class="mord mathnormal">p</span><span class="mord mathnormal">a</span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">126</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">50</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord">12</span><span class="mord"><span class="mord">6</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">112</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord">12</span><span class="mord"><span class="mord">6</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">97</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord">12</span><span class="mord"><span class="mord">6</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">99</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord">12</span><span class="mord"><span class="mord">6</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8389em;vertical-align:-0.1944em;"></span><span class="mord">101</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">809</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">233</span></span></span></span></li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi><mi>G</mi><mi>g</mi><msub><mo stretchy="false">!</mo><mn>126</mn></msub><mo>=</mo><mo stretchy="false">(</mo><mn>98</mn><mo>×</mo><msup><mn>126</mn><mn>3</mn></msup><mo stretchy="false">)</mo><mo>+</mo><mo stretchy="false">(</mo><mn>71</mn><mo>×</mo><msup><mn>126</mn><mn>2</mn></msup><mo stretchy="false">)</mo><mo>+</mo><mo stretchy="false">(</mo><mn>98</mn><mo>×</mo><msup><mn>126</mn><mn>1</mn></msup><mo stretchy="false">)</mo><mo>+</mo><mo stretchy="false">(</mo><mn>33</mn><mo>×</mo><msup><mn>126</mn><mn>0</mn></msup><mo stretchy="false">)</mo><mo>=</mo><mn>203</mn><mo separator="true">,</mo><mn>178</mn><mo separator="true">,</mo><mn>213</mn></mrow><annotation encoding="application/x-tex">eGg!_{126} = (98 \times 126^3) + (71 \times 126^2) + (98 \times 126^1) + (33 \times 126^0) = 203,178,213</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">e</span><span class="mord mathnormal">G</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mclose"><span class="mclose">!</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">126</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">98</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord">12</span><span class="mord"><span class="mord">6</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">71</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord">12</span><span class="mord"><span class="mord">6</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">98</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord">12</span><span class="mord"><span class="mord">6</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">33</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord">12</span><span class="mord"><span class="mord">6</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8389em;vertical-align:-0.1944em;"></span><span class="mord">203</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">178</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">213</span></span></span></span></li>
</ul>
<p>下面是一段将字符串转换为整数的程序：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">asciiToInt</span><span class="params">(String s)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">intRep</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; s.length(); i += <span class="number">1</span>) &#123;</span><br><span class="line">        intRep = intRep * <span class="number">126</span>;</span><br><span class="line">        intRep = intRep + s.charAt(i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> intRep;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果想用 ASCII 之外的字符该怎么办？</p>
<p>Java 中的 <code>char</code> 类型也支持其它语言和符号的字符集：</p>
<ul>
<li><code>char c = '☂'</code> 等价于 <code>char c = 9730</code></li>
<li><code>char c = '鳌'</code> 等价于 <code>char c = 4014</code></li>
<li><code>char c = '혜'</code> 等价于 <code>char c = 5481</code></li>
</ul>
<p>这种编码方式被称为 Unicode。其对应表过于庞大，无法在此一一列举。</p>
<p>而中文字符的最大可能值为 40,959，因此如果我们需要为所有可能的中文字符串建立唯一表示，就必须以该值作为底数。如：</p>
<ul>
<li>守门员 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mrow></mrow><mn>40959</mn></msub><mo>=</mo><mo stretchy="false">(</mo><mn>23432</mn><mo>×</mo><msup><mn>40959</mn><mn>2</mn></msup><mo stretchy="false">)</mo><mo>+</mo><mo stretchy="false">(</mo><mn>38376</mn><mo>×</mo><msup><mn>40959</mn><mn>1</mn></msup><mo stretchy="false">)</mo><mo>+</mo><mo stretchy="false">(</mo><mn>21592</mn><mo>×</mo><msup><mn>40959</mn><mn>0</mn></msup><mo stretchy="false">)</mo><mo>=</mo><mn>39</mn><mo separator="true">,</mo><mn>312</mn><mo separator="true">,</mo><mn>024</mn><mo separator="true">,</mo><mn>869</mn><mo separator="true">,</mo><mn>368</mn></mrow><annotation encoding="application/x-tex">_{40959} = (23432 \times 40959^2) + (38376 \times 40959^1) + (21592 \times 40959^0) = 39,312,024,869,368</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5169em;vertical-align:-0.15em;"></span><span class="mord"><span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">40959</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">23432</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord">4095</span><span class="mord"><span class="mord">9</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">38376</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord">4095</span><span class="mord"><span class="mord">9</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">21592</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord">4095</span><span class="mord"><span class="mord">9</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8389em;vertical-align:-0.1944em;"></span><span class="mord">39</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">312</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">024</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">869</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">368</span></span></span></span></li>
</ul>
<p>目前为止，我们一直在尝试将任何可能出现的字符串映射到一个唯一的整数。但前面我们也提到过，在 Java 中，最大的整数就是 2,147,483,647。如果你超过了这个界限，你就整数溢出了，计数将从最小的整数 -2,147,483,648 开始了。换句话说，2,147,483,647 的下一个数是 -2,147,483,648 而不是 2,147,483,648。</p>
<p>所以即使是以 126 为底数的英文字符串，也会导致整型溢出，更别提中文字符了。</p>
<ul>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>o</mi><mi>m</mi><mi>e</mi><mi>n</mi><msub><mi>s</mi><mn>126</mn></msub><mo>=</mo><mn>28</mn><mo separator="true">,</mo><mn>196</mn><mo separator="true">,</mo><mn>917</mn><mo separator="true">,</mo><mn>171</mn></mrow><annotation encoding="application/x-tex">omens_{126} = 28,196,917,171</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord mathnormal">o</span><span class="mord mathnormal">m</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">126</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8389em;vertical-align:-0.1944em;"></span><span class="mord">28</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">196</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">917</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">171</span></span></span></span> 这个值比 Java 的最大整数大多了，运行 <code>asciiToInt(&quot;omens&quot;)</code> 的结果是 -1,867,853,901。</li>
</ul>
<h3 id="哈希码">哈希码</h3>
<p>由于 Java 的整数是有限的，我们这个“每个字符串都对应一个独一无二的整数”的集合最大就只能有 40 多亿个元素。</p>
<p>而我们一直在计算的这个数的正式术语称为 <strong>哈希码(hash code)</strong>。</p>
<blockquote>
<p>根据 Wolfram Alpha 的定义：哈希函数（hash function）是一个“将一个具有大量（甚至无限）元素的集合中的值，映射到一个具有固定（较少）数量元素的集合中的值”的函数。<br>
在这里，我们是将无限大的字符串集合映射到 Java 的整型数集合，其大小为 4,294,967,296。</p>
</blockquote>
<p>也就是说，我们的整型化函数之所以被称为“哈希码”，是因为我们映射到的目标集合是固定大小的。而由于哈希码的取值范围是有限的，因此不可能为每个字符串都实现唯一的哈希编码。所以 Java 没有为了保证唯一性将 40,959 作为底数，而是使用 <strong>31</strong>。</p>
<ul>
<li>守门员 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mrow></mrow><mn>31</mn></msub><mo>=</mo><mo stretchy="false">(</mo><mn>23432</mn><mo>×</mo><msup><mn>31</mn><mn>2</mn></msup><mo stretchy="false">)</mo><mo>+</mo><mo stretchy="false">(</mo><mn>38376</mn><mo>×</mo><msup><mn>31</mn><mn>1</mn></msup><mo stretchy="false">)</mo><mo>+</mo><mo stretchy="false">(</mo><mn>21592</mn><mo>×</mo><msup><mn>31</mn><mn>0</mn></msup><mo stretchy="false">)</mo><mo>=</mo><mn>23</mn><mo separator="true">,</mo><mn>729</mn><mo separator="true">,</mo><mn>400</mn></mrow><annotation encoding="application/x-tex">_{31} = (23432 \times 31^2) + (38376 \times 31^1) + (21592 \times 31^0) = 23,729,400</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5169em;vertical-align:-0.15em;"></span><span class="mord"><span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">31</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">23432</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord">3</span><span class="mord"><span class="mord">1</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">38376</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord">3</span><span class="mord"><span class="mord">1</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">21592</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord">3</span><span class="mord"><span class="mord">1</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8389em;vertical-align:-0.1944em;"></span><span class="mord">23</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">729</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">400</span></span></span></span></li>
<li>尝试运行 <code>System.out.println(&quot;守门员&quot;.hashCode());</code> 你会得到结果的。</li>
</ul>
<p>当然无限的字符串集中也会有其它字符串同样映射到这个值，如：</p>
<ul>
<li>孡㜹ቘᡇ஝俎 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mrow></mrow><mn>31</mn></msub><mo>=</mo><mo stretchy="false">(</mo><mn>23393</mn><mo>×</mo><msup><mn>31</mn><mn>5</mn></msup><mo stretchy="false">)</mo><mo>+</mo><mo stretchy="false">(</mo><mn>14137</mn><mo>×</mo><msup><mn>31</mn><mn>4</mn></msup><mo stretchy="false">)</mo><mo>+</mo><mo stretchy="false">(</mo><mn>4696</mn><mo>×</mo><msup><mn>31</mn><mn>3</mn></msup><mo stretchy="false">)</mo><mo>+</mo><mo stretchy="false">(</mo><mn>6215</mn><mo>×</mo><msup><mn>31</mn><mn>2</mn></msup><mo stretchy="false">)</mo><mo>+</mo><mo stretchy="false">(</mo><mn>2973</mn><mo>×</mo><msup><mn>31</mn><mn>1</mn></msup><mo stretchy="false">)</mo><mo>+</mo><mo stretchy="false">(</mo><mn>20430</mn><mo>×</mo><msup><mn>31</mn><mn>0</mn></msup><mo stretchy="false">)</mo><mo>=</mo><mn>682</mn><mo separator="true">,</mo><mn>923</mn><mo separator="true">,</mo><mn>529</mn><mo separator="true">,</mo><mn>464</mn></mrow><annotation encoding="application/x-tex">_{31} = (23393 \times 31^5) + (14137 \times 31^4) + (4696 \times 31^3) + (6215 \times 31^2) + (2973 \times 31^1) + (20430 \times 31^0) = 682,923,529,464</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5169em;vertical-align:-0.15em;"></span><span class="mord"><span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">31</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">23393</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord">3</span><span class="mord"><span class="mord">1</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">14137</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord">3</span><span class="mord"><span class="mord">1</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">4696</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord">3</span><span class="mord"><span class="mord">1</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">6215</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord">3</span><span class="mord"><span class="mord">1</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">2973</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord">3</span><span class="mord"><span class="mord">1</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">20430</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord">3</span><span class="mord"><span class="mord">1</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8389em;vertical-align:-0.1944em;"></span><span class="mord">682</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">923</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">529</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">464</span></span></span></span></li>
<li>682,923,529,464 整数溢出后的值就是 23,729,400。</li>
</ul>
<h3 id="哈希表">哈希表</h3>
<p>现在我们终于得到了哈希表（hash table）。</p>
<ul>
<li>数据通过 <strong>哈希函数</strong> 转换为称为 <strong>哈希码</strong> 的整数表示，其取值范围为 -2,147,483,648 到 2,147,483,647。</li>
<li>哈希码随后会被缩减函数规约为一个有效索引，通常通过求模实现，例如：2348762878 % 10 = 8。</li>
</ul>
<p><img src="/img/HashingPost/1.9.jpg" alt=""></p>
<p>需要注意的是，哈希表存在多种实现方式。</p>
<p>我们当前使用的是由链表构成的数组结构（array of lists），这种方式有时被称为&quot;分离链表法&quot;（separate chaining）——其中每个桶（bucket）都是一个独立的元素链。</p>
<p>此外还存在更多复杂实现方案（如线性探测法、布谷鸟哈希法、使用非链表结构作为桶等）。</p>
<h2 id="Java-中的哈希表">Java 中的哈希表</h2>
<p>事实上，哈希表是集合和映射最常用的实现方式。</p>
<ul>
<li>它在实际应用中性能出色</li>
<li>不要求元素实现 Comparable</li>
<li>实现起来相对简单</li>
<li>Python 的字典（dictionary）本质上就是哈希表</li>
</ul>
<p>在 Java 中，哈希表通过 java.util.HashMap 和 java.util.HashSet 实现。而 HashMap 又是如何计算每个对象的哈希码呢？</p>
<ul>
<li>好消息是：Java并不需要 <code>implements Hashable</code></li>
<li>实际上，还记得我们在介绍 <a href="/2025/05/22/Data-Structure/#Object-%E7%B1%BB">Object 类</a>时提到的所有对象从 Object 继承的方法吗？Java 中的所有对象都必须实现 <code>.hashCode()</code> 方法。</li>
</ul>
<h3 id="负哈希码">负哈希码</h3>
<p>既然哈希码最小能够取到 -2,147,483,648，如果哈希码为负，又该如何取到它的有效索引呢？</p>
<p>假设 <img src="/img/HashingPost/Enchanted_Golden_Apple.gif" style="vertical-align: middle; height: 30px; display: inline;" /> 的哈希码是 -1，应放在 <img src="/img/HashingPost/1.10.jpg" style="vertical-align: middle; height: 120px; display: inline;" /> 的哪个格子中呢？</p>
<ul>
<li>-1 % 4 = -1，将会导致索引错误，所以通常利用 <code>Math.floorMod</code> 进行计算。不妨尝试运行下面一段程序：</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ModTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(-<span class="number">1</span> % <span class="number">4</span>);</span><br><span class="line">        System.out.println(Math.floorMod(-<span class="number">1</span>, <span class="number">4</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>所以我们的缩减函数也应使用 <code>Math.floorMod</code> 而不是简单的求模运算。</p>
<p><img src="/img/HashingPost/1.11.jpg" alt=""></p>
<h2 id="哈希表的性能表现与总结">哈希表的性能表现与总结</h2>
<p>对于无法 <code>resize</code> 的哈希表：</p>
<ul>
<li>桶的数量恒为 M，元素数量 N 不断递增</li>
<li>若将每个元素平均分配，则每个桶中元素数量为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mi mathvariant="normal">/</mi><mi>M</mi></mrow><annotation encoding="application/x-tex">N / M</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mord">/</span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span></span></span></span></li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi><mo>∈</mo><mi mathvariant="normal">Θ</mi><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">M \in \Theta(1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">Θ</span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span></span></span></span> ，则每次操作的运行时间 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">Θ</mi><mo stretchy="false">(</mo><mi>N</mi><mi mathvariant="normal">/</mi><mi>M</mi><mo stretchy="false">)</mo><mo>=</mo><mi mathvariant="normal">Θ</mi><mo stretchy="false">(</mo><mi>N</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\Theta(N / M) = \Theta(N)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">Θ</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mord">/</span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">Θ</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mclose">)</span></span></span></span>。</li>
</ul>
<p>对于可 <code>resize</code> 的哈希表：</p>
<ul>
<li>桶的数量 M 随着元素数量 N 的递增而递增</li>
<li>若将每个元素平均分配，则每个桶中元素数量为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mi mathvariant="normal">/</mi><mi>M</mi></mrow><annotation encoding="application/x-tex">N / M</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mord">/</span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span></span></span></span></li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi><mo>∈</mo><mi mathvariant="normal">Θ</mi><mo stretchy="false">(</mo><mi>N</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">M \in \Theta(N)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">Θ</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mclose">)</span></span></span></span> ，则每次操作的运行时间 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">Θ</mi><mo stretchy="false">(</mo><mi>N</mi><mi mathvariant="normal">/</mi><mi>M</mi><mo stretchy="false">)</mo><mo>=</mo><mi mathvariant="normal">Θ</mi><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\Theta(N / M) = \Theta(1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">Θ</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mord">/</span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">Θ</span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span></span></span></span>。</li>
</ul>
<p>以上两种情况的前提都是元素的均匀分配。<strong>哈希表中元素的均匀分布对性能至关重要。</strong> 下面两种哈希表的负载因数都为 1，但显然右边的哈希表要优于左边的：</p>
<table>
<thead>
<tr>
<th style="text-align:center"><img src="/img/HashingPost/1.12.jpg" alt=""></th>
<th style="text-align:center"><img src="/img/HashingPost/1.13.jpg" alt=""></th>
</tr>
</thead>
</table>
<p>总结一下：</p>
<ul>
<li>数据首先被转换成哈希码</li>
<li>接着哈希码会被缩减为有效索引</li>
<li>数据会根据有效索引被存储到一个桶中</li>
<li>当负载因数 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mi mathvariant="normal">/</mi><mi>M</mi></mrow><annotation encoding="application/x-tex">N / M</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mord">/</span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span></span></span></span> 达到某个常数时进行 resize</li>
<li>如果所有元素都被平均分配到每一个桶中，则每次操作的平均用时为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">Θ</mi><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\Theta(1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">Θ</span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span></span></span></span></li>
</ul>
<h1>再探哈希表</h1>
<p>对哈希表有了初步的理解，接下来让我们进一步理解：</p>
<ul>
<li>哈希码如何影响元素的分配？</li>
<li><code>equals()</code> 与 <code>hashCode()</code> 之间有何联系？</li>
<li>为何哈希表即使底层使用链表，运行速度仍然很快？</li>
</ul>
<h2 id="元素的分配">元素的分配</h2>
<p>已经厌倦了字符串的我们现在打算向哈希表中插入名为 <code>ColoredNumber</code> 的对象，每个对象包含两个属性：数字的值 <code>private int num</code> 和数字的颜色 <code>private Color color</code>。当我们将 <code>ColoredNumbers</code> 0 到 19 插入一个带有 6 个桶的哈希表中，将会发生什么？</p>
<p><img src="/img/HashingPost/2.1.jpg" alt=""></p>
<p>对于这些元素的分配，你注意到了什么？</p>
<ul>
<li>十分随机，无逻辑可寻，且相对平均</li>
<li>有的行是其它行的二倍</li>
<li>奇数编号的行比偶数编号的长</li>
<li>数字 19 为什么会出现在第 0 行？</li>
</ul>
<p>事实上 Java 默认的 <code>hashCode()</code> 实现（通常）直接使用 <strong>对象的内存地址</strong> 作为哈希值。例如：当你 <code>new ColoredNumber(2)</code> 时，返回的哈希码就是该对象在内存中的实际地址值。而将该哈希码对 6 取模后的结果恰好就是 0。</p>
<p>假如我们将 <code>hashCode()</code> 方法重写为只返回 0：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">hashCode</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>现在我们元素分配后的结果就变为了：</p>
<p><img src="/img/HashingPost/2.2.jpg" alt=""></p>
<p>那如果我们想得到下面的分配结果，又该如何重写 <code>hashCode()</code> 方法？</p>
<p><img src="/img/HashingPost/2.3.jpg" alt=""></p>
<p><s>直接 <code>return num</code> 就可以了。</s></p>
<p>因此，我们可以将哈希函数定义为任何我们想要的样子。</p>
<h2 id="hashCode-与-equals"><code>hashCode()</code> 与 <code>equals()</code></h2>
<h3 id="为何需要自定义哈希函数？">为何需要自定义哈希函数？</h3>
<p>哈希函数的目的是尽量让元素均匀分布。</p>
<ul>
<li>您是完全不分散吗：return 0</li>
<li>欠佳的分散性：return 各位数字之和</li>
<li>良好的分散性：return num</li>
</ul>
<p>那 <code>hashCode()</code> 默认按照内存地址分配的逻辑是好的吗？</p>
<p>其实是好的，内存地址实际上是随机的，因此元素也应该会均匀分布。</p>
<p><em>那既然 <code>hashCode()</code> 的默认实现能达到很好的分散性，为什么我们还需要费尽心思重新自定义一遍呢？</em></p>
<h3 id="contains"><code>contains()</code></h3>
<p>假如 <code>ColoredNumber</code> 类的 <code>equals()</code> 方法如下所示：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object o)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (o <span class="keyword">instanceof</span> ColoredNumber otherCn) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.num == otherCn.num;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>只要两个 <code>ColoredNumber</code> 的数值相等，它们就是相等的。</p>
<p>有了这个前提，现在我们向哈希表中添加 20 个元素：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">N</span> <span class="operator">=</span> <span class="number">20</span>;</span><br><span class="line">HashSet&lt;ColoredNumber&gt; hs = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; N; i += <span class="number">1</span>) &#123;</span><br><span class="line">    hs.add(<span class="keyword">new</span> <span class="title class_">ColoredNumber</span>(i));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接着查看 12 是否在哈希表中：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">ColoredNumber</span> <span class="variable">twelve</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ColoredNumber</span>(<span class="number">12</span>);</span><br><span class="line">hs.contains(twelve); <span class="comment">// returns ??</span></span><br></pre></td></tr></table></figure>
<p>程序返回的结果应该是什么？</p>
<p>如果按照 <code>equals()</code> 的逻辑，两个 <code>ColoredNumber</code> 的数值相等它们就是相等的，程序应该返回 <code>true</code>。但事实是如此吗？</p>
<p>事实上，程序返回 <code>true</code> 的概率为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mn>1</mn><mn>6</mn></mfrac></mrow><annotation encoding="application/x-tex">\frac{1}{6}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1901em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">6</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span> 而返回 <code>false</code> 的概率为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mn>5</mn><mn>6</mn></mfrac></mrow><annotation encoding="application/x-tex">\frac{5}{6}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1901em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">6</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">5</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>。为什么会这样？</p>
<p>因为 <code>hashCode()</code> 是基于内存地址进行元素分配的，而开始时插入的 12 与查询时的 <code>twelve</code> 是分别 <code>new</code> 出来的两个对象，它们的 <strong>内存地址是不同的</strong>。因而 <code>twelve</code> 按照内存地址取模后分配到的桶与当初插入的 12 所在的桶相同的概率只有 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mn>1</mn><mn>6</mn></mfrac></mrow><annotation encoding="application/x-tex">\frac{1}{6}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1901em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">6</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>。剩下 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mn>5</mn><mn>6</mn></mfrac></mrow><annotation encoding="application/x-tex">\frac{5}{6}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1901em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">6</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">5</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span> 的概率目标对象和查询对象都不在同一个桶中，<code>equals()</code> 自然不可能返回 <code>true</code>。而 <code>contains()</code> 又依赖于 <code>equals()</code> 的返回值来判断目标值是否存在，结果显而易见。</p>
<p>所以换句话说：<strong>如果两个对象是相同的，那么它们应该拥有相同的哈希码，这样哈希表才能够找到它</strong> ，这是最基本的原则。</p>
<p>现在回到上一节留下了的问题：</p>
<blockquote>
<p>既然 <code>hashCode()</code> 的默认实现能达到很好的分散性，为什么我们还需要费尽心思重新自定义一遍呢？</p>
</blockquote>
<p><strong>因为必须保持 <code>equals()</code> 和 <code>hashCode()</code> 的一致性，这是基础操作正常工作的必要条件。</strong></p>
<h3 id="重复值">重复值</h3>
<p>假设我们的 <code>equals()</code> 方法不变，仍然不重写 <code>hashCode()</code>：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object o)</span> &#123;</span><br><span class="line">    ...  <span class="keyword">return</span> <span class="built_in">this</span>.num == otherCn.num; ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">ColoredNumber</span> <span class="variable">zero</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ColoredNumber</span>(<span class="number">0</span>);</span><br><span class="line">hs.add(zero); <span class="comment">// does another zero appear?</span></span><br></pre></td></tr></table></figure>
<p>如果我们在下面的哈希表中调用 <code>add(zero)</code> 会发生什么？</p>
<ul>
<li>A. 0 号桶中会添加一个 0</li>
<li>B. 1 号桶中会再添加一个 0</li>
<li>C. 其它桶中会添加一个 0</li>
<li>D. 同一个桶中不会出现重复的 0</li>
</ul>
<p><img src="/img/HashingPost/2.4.jpg" alt=""></p>
<p><s>答案是 ACD</s></p>
<p><code>add()</code> 的流程是根据 <code>zero</code> 的哈希值模 6 后的结果选择相应的桶，接着遍历该桶并不断检查 <code>equals(zero)</code>。如果返回 1 了就直接退出，如果一直遍历到最后了仍没退出就添加 <code>zero</code>。所以如果同一个桶中有了重复元素，<code>equals()</code> 会直接阻止添加；但如果重复元素没有出现在同一个桶中，<code>equals()</code> 就无能为力了。</p>
<p>所以综上，基于 <strong>如果两个对象是相同的，那么它们应该拥有相同的哈希码</strong> 的原则，</p>
<p><strong>如果类重写了 <code>equals()</code> 方法，就必须以一致的方式重写 <code>hashCode()</code> 方法</strong> 。</p>
<p>否则将导致 HashSet/HashMap 等集合类出现不可预测的行为，这是 Java 对象契约中最关键的约束条件之一。</p>
<h2 id="可变键值的风险">可变键值的风险</h2>
<h3 id="可变类型与不可变类型">可变类型与不可变类型</h3>
<p>不可变数据类型（immutable data type）是指一旦你实例化对象，它就无法以任何可观察的方式修改的数据类型。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Date</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> month;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> day;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> year;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">contrived</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Date</span><span class="params">(<span class="type">int</span> m, <span class="type">int</span> d, <span class="type">int</span> y)</span> &#123;</span><br><span class="line">        month = m;</span><br><span class="line">        day = d;</span><br><span class="line">        year = y;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>final</code> 关键字可辅助编译器确保不可变性：</p>
<ul>
<li><code>final</code> 变量仅允许一次赋值（在构造器或初始化器中），赋值后永不可修改</li>
<li><code>final</code> 既不是实现类不可变的充分条件，也不是必要条件</li>
</ul>
<p>下面这四个例子中，哪些是可变的哪些是不可变的？</p>
<p><img src="/img/HashingPost/2.5.jpg" alt=""></p>
<p>显然，第一个是可变的，只要实例化一个 <code>Pebble p</code> 后直接 <code>p.weight = 2;</code> 就可以修改了。</p>
<p>第二个，我们刚刚介绍过，显然是不可变的。也许我们可以通过某些特殊的手段来修改，但正常来说就是不可变的。</p>
<p>第三个是可变的。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Rock</span> <span class="variable">r1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Rock</span>(<span class="number">10</span>);</span><br><span class="line"><span class="type">Rock</span> <span class="variable">r2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Rock</span>(<span class="number">20</span>);</span><br><span class="line">Rock[] rox = &#123;r1, r2&#125;;</span><br><span class="line"><span class="type">RocksBox</span> <span class="variable">rb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RocksBox</span>(rox);</span><br><span class="line">rb.rocks[<span class="number">1</span>] = <span class="literal">null</span>;</span><br></pre></td></tr></table></figure>
<p>虽然 <code>RocksBox</code> 的内部字段 <code>rocks</code> 被声明为 <code>final</code>，但众所周知数组是引用类型，它的内存地址存储的是对数组对象的引用而不是数组本身。将其声明为 <code>final</code> 只意味着 <code>rocks</code> 对应的用于存储对象地址的 64 位内存无法改变，该地址指向的对象就无法被控制了。因此 <code>rb.rocks[1] = null;</code> 能够直接对数组进行修改。</p>
<p>第四个，即使我们将 <code>rocks</code> 声明为 <code>private</code>，这也是可变性非常微妙的原因之一，<code>rocks</code> 仍然是会受到某种类型的攻击：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Rock</span> <span class="variable">r1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Rock</span>(<span class="number">10</span>);</span><br><span class="line"><span class="type">Rock</span> <span class="variable">r2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Rock</span>(<span class="number">20</span>);</span><br><span class="line">Rock[] rox = &#123;r1, r2&#125;;</span><br><span class="line"><span class="type">SecretRocksBox</span> <span class="variable">rb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SecretRocksBox</span>(rox);</span><br><span class="line">rox[<span class="number">0</span>] = <span class="keyword">new</span> <span class="title class_">Rock</span>(-<span class="number">999</span>);</span><br></pre></td></tr></table></figure>
<p>我们在介绍引用类型时提到过，Java 是引用副本传递类型，因此 <code>rox</code> 和 <code>rocks</code> 是两个指向同一个副本的引用。即使 <code>rocks</code> 是私有的，那只意味着你无法通过 <code>rocks</code> 对对象进行修改而已。通过 <code>rox</code> 修改仍然会影响到 <code>rocks</code> 指向的对象。</p>
<p>解决方法也很简单：既然会产生这种影响是因为两个引用指向同一个对象，那么我让不可变的那个引用指向一个只属于它自己的对象不就好了吗？</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecretRocks</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Rock[] rocks;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SecretRocks</span><span class="params">(Rock[] rox)</span> &#123;</span><br><span class="line">        rocks = <span class="keyword">new</span> <span class="title class_">Rock</span>[rox.length];</span><br><span class="line">        System.arraycopy(rox, <span class="number">0</span>,</span><br><span class="line">                rocks, <span class="number">0</span>,</span><br><span class="line">                rox.length);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样无论如何修改 <code>rox</code> 都不可能影响 <code>rocks</code> 了。</p>
<h3 id="可变哈希键">可变哈希键</h3>
<p>为什么要介绍上面这些东西？事实上，我们可以创建一个 <code>HashSet&lt;List&gt;</code>，但如果：</p>
<ul>
<li>向 <code>HashSet</code> 中插入一个 <code>List</code></li>
<li>接着修改那个 <code>List</code></li>
</ul>
<p>将发生一些奇怪的事情。</p>
<p>假如我们有一个 <code>ArrayList items</code> 为 [0, 1]，该列表的哈希码为 962。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;Integer&gt; items = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">items.add(<span class="number">0</span>);</span><br><span class="line">items.add(<span class="number">1</span>);</span><br><span class="line">System.out.println(items.hashCode());   <span class="comment">// 可以运行看看</span></span><br></pre></td></tr></table></figure>
<p>如果我们将该列表添加到一个有 4 个桶的 HashSet 中，它将被分配到 2 号桶（962 % 4 = 2）。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">HashSet&lt;List&lt;Integer&gt;&gt; hs = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">hs.add(items);</span><br></pre></td></tr></table></figure>
<p><img src="/img/HashingPost/2.6.jpg" alt=""></p>
<p>接着我们再添加一个列表 [2, 3]，该列表的哈希码为 1026，也将被分配到 2 号桶。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">hs.add(List.of(<span class="number">2</span>, <span class="number">3</span>));</span><br></pre></td></tr></table></figure>
<p><img src="/img/HashingPost/2.7.jpg" alt=""></p>
<p>现在我们向 <code>items</code> 中添加一个数字 7，<code>items</code> 的哈希码将变为 29829，这会产生什么问题？</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">items.add(<span class="number">7</span>);</span><br></pre></td></tr></table></figure>
<p><img src="/img/HashingPost/2.8.jpg" alt=""></p>
<p>如果我们调用 <code>contains(items)</code>：</p>
<ul>
<li>29829 % 4 = 1</li>
<li>哈希表将检查 1 号桶并发现为空！</li>
</ul>
<p>所以 <strong>永远不要修改一个被用作键的对象！</strong> 否则将导致数据检索错误和元素的丢失。这是因为添加时与查找时所依据的哈希码不同，导致违反 <code>key.equals(key) == true</code> 的基本契约。</p>
<h2 id="附录">附录</h2>
<h3 id="哈希表的一些基本契约">哈希表的一些基本契约</h3>
<h4 id="哈希码一致性（Hash-Code-Consistency）">哈希码一致性（Hash Code Consistency）</h4>
<ul>
<li>若 <code>a.equals(b) == true</code>，则 <code>a.hashCode() == b.hashCode()</code>
<ul>
<li>两个逻辑相等的对象返回不同哈希码，会导致哈希表无法正确检索</li>
</ul>
</li>
</ul>
<h4 id="等价性对称（Equivalence-Symmetry）">等价性对称（Equivalence Symmetry）</h4>
<ul>
<li><code>a.equals(b)</code> 必须与 <code>b.equals(a)</code> 结果一致
<ul>
<li>违反后果：可能造成哈希表重复存储逻辑相同的键</li>
</ul>
</li>
</ul>
<h4 id="空键处理（Null-Key-Handling）">空键处理（Null Key Handling）</h4>
<ul>
<li>多数实现要求哈希表必须能处理 <code>null</code> 键（如Java的 <code>HashMap</code>）
<ul>
<li>某些优化版哈希表（如Android的 <code>ArrayMap</code>）可能禁止 <code>null</code> 键</li>
</ul>
</li>
</ul>
<h4 id="哈希冲突处理（Collision-Resolution）">哈希冲突处理（Collision Resolution）</h4>
<ul>
<li>即使 <code>a.hashCode() == b.hashCode()</code> 但 <code>!a.equals(b)</code>，哈希表仍需正确存储这两个键
<ul>
<li>实现方式：通过链表/红黑树（Java 8+的 <code>HashMap</code>）或开放寻址法处理冲突</li>
</ul>
</li>
</ul>
<h4 id="时间复杂性保证（Time-Complexity）">时间复杂性保证（Time Complexity）</h4>
<ul>
<li>插入/查找/删除操作平均时间复杂度应为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span></span></span></span></li>
</ul>
<h4 id="不可变键推荐（Immutability-Recommendation）">不可变键推荐（Immutability Recommendation）</h4>
<ul>
<li>键对象应为不可变（如 <code>String</code>、<code>Integer</code>）
<ul>
<li>若键对象被修改，会导致：
<ul>
<li>哈希码变化 → 无法通过 <code>get()</code> 检索原值</li>
<li>内存泄漏 → 旧哈希桶中的条目成为&quot;僵尸数据&quot;</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="负载因数约束（Load-Factor-Control）">负载因数约束（Load Factor Control）</h4>
<ul>
<li>当负载因数超过 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mi mathvariant="normal">/</mi><mi>M</mi></mrow><annotation encoding="application/x-tex">N / M</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mord">/</span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span></span></span></span> 时自动扩容并重新哈希
<ul>
<li>Java <code>HashMap</code> 默认负载因数为 0.75</li>
</ul>
</li>
</ul>
<h4 id="违反契约的典型后果">违反契约的典型后果</h4>
<table>
<thead>
<tr>
<th style="text-align:center">违反类型</th>
<th style="text-align:center">可能结果</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">哈希码不一致</td>
<td style="text-align:center"><code>HashSet.contains()</code> 返回错误结果</td>
</tr>
<tr>
<td style="text-align:center">可变键修改</td>
<td style="text-align:center">数据&quot;消失&quot;（实际仍存在于错误桶中）</td>
</tr>
<tr>
<td style="text-align:center">非对称等价性</td>
<td style="text-align:center">重复存储逻辑相同的键</td>
</tr>
</tbody>
</table>
<h3 id="Java-的-HashSet-实现">Java 的 HashSet 实现</h3>
<blockquote>
<p>HashSet: <a target="_blank" rel="noopener" href="https://github.com/openjdk/jdk/blob/master/src/java.base/share/classes/java/util/HashSet.java">https://github.com/openjdk/jdk/blob/master/src/java.base/share/classes/java/util/HashSet.java</a><br>
HashMap: <a target="_blank" rel="noopener" href="https://github.com/openjdk/jdk/blob/master/src/java.base/share/classes/java/util/HashMap.java">https://github.com/openjdk/jdk/blob/master/src/java.base/share/classes/java/util/HashMap.java</a></p>
</blockquote>
<p><img src="/img/HashingPost/2.9.jpg" alt=""></p>
<h3 id="FAQ">FAQ</h3>
<p>哈希集合（Hash Set）、哈希映射（Hash Map）与哈希表（Hash Table）直接有何区别？</p>
<ul>
<li>哈希集合是基于“哈希表”实现的集合抽象数据类型（Set ADT）。</li>
<li>哈希映射是基于“哈希表”实现的映射抽象数据类型（Map ADT）。</li>
<li>哈希表是一种存储信息的方式，其利用 M 个桶来存储 N 个元素。每个元素都有一个“hashCode”，用于确定应放入 M 个桶中的哪一个。</li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a target="_blank" rel="noopener" href="https://github.com/WatsonthePeanut">WatsonthePeanut</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2025/08/14/Hashing/">http://example.com/2025/08/14/Hashing/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="http://example.com" target="_blank">夢よ未来へ</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Data-Structure/">Data Structure</a><a class="post-meta__tags" href="/tags/CS61B/">CS61B</a></div><div class="post-share"><div class="social-share" data-image="/img/HashingPost/0.0.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related full-width no-desc" href="/2025/08/12/Lab-7-BSTMap/" title="Lab 7: BSTMap"><img class="cover" src="/img/cover.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">Lab 7: BSTMap</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related no-desc" href="/2025/06/05/Arrays/" title="数组（Arrays）"><img class="cover" src="/img/ArraysPost/0.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-06-05</div><div class="info-item-2">数组（Arrays）</div></div></div></a><a class="pagination-related" href="/2025/07/31/Asymptotics/" title="渐近分析"><img class="cover" src="/img/AsymptoticsPost/0.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-07-31</div><div class="info-item-2">渐近分析</div></div><div class="info-2"><div class="info-item-1">大概是一节数学课</div></div></div></a><a class="pagination-related" href="/2025/05/22/Data-Structure/" title="Data Structure"><img class="cover" src="/img/dataStructurePost/0.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-22</div><div class="info-item-2">Data Structure</div></div><div class="info-2"><div class="info-item-1">基于 CS 61B Spring 2024 的数据结构笔记</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="giscus-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">初识哈希表</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%93%88%E5%B8%8C%E8%A1%A8%E7%9A%84%E6%8E%A8%E5%AF%BC"><span class="toc-number">1.1.</span> <span class="toc-text">哈希表的推导</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ArrayOfListsSet"><span class="toc-number">1.1.1.</span> <span class="toc-text">ArrayOfListsSet</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DynamicArrayOfListsSet"><span class="toc-number">1.1.2.</span> <span class="toc-text">DynamicArrayOfListsSet</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%8F%E5%86%99%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">1.1.3.</span> <span class="toc-text">小写字符串</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B4%E6%95%B0%E6%BA%A2%E5%87%BA"><span class="toc-number">1.1.4.</span> <span class="toc-text">整数溢出</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%93%88%E5%B8%8C%E7%A0%81"><span class="toc-number">1.1.5.</span> <span class="toc-text">哈希码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%93%88%E5%B8%8C%E8%A1%A8"><span class="toc-number">1.1.6.</span> <span class="toc-text">哈希表</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Java-%E4%B8%AD%E7%9A%84%E5%93%88%E5%B8%8C%E8%A1%A8"><span class="toc-number">1.2.</span> <span class="toc-text">Java 中的哈希表</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B4%9F%E5%93%88%E5%B8%8C%E7%A0%81"><span class="toc-number">1.2.1.</span> <span class="toc-text">负哈希码</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%93%88%E5%B8%8C%E8%A1%A8%E7%9A%84%E6%80%A7%E8%83%BD%E8%A1%A8%E7%8E%B0%E4%B8%8E%E6%80%BB%E7%BB%93"><span class="toc-number">1.3.</span> <span class="toc-text">哈希表的性能表现与总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">2.</span> <span class="toc-text">再探哈希表</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%83%E7%B4%A0%E7%9A%84%E5%88%86%E9%85%8D"><span class="toc-number">2.1.</span> <span class="toc-text">元素的分配</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#hashCode-%E4%B8%8E-equals"><span class="toc-number">2.2.</span> <span class="toc-text">hashCode() 与 equals()</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BD%95%E9%9C%80%E8%A6%81%E8%87%AA%E5%AE%9A%E4%B9%89%E5%93%88%E5%B8%8C%E5%87%BD%E6%95%B0%EF%BC%9F"><span class="toc-number">2.2.1.</span> <span class="toc-text">为何需要自定义哈希函数？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#contains"><span class="toc-number">2.2.2.</span> <span class="toc-text">contains()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E5%A4%8D%E5%80%BC"><span class="toc-number">2.2.3.</span> <span class="toc-text">重复值</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%AF%E5%8F%98%E9%94%AE%E5%80%BC%E7%9A%84%E9%A3%8E%E9%99%A9"><span class="toc-number">2.3.</span> <span class="toc-text">可变键值的风险</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%AF%E5%8F%98%E7%B1%BB%E5%9E%8B%E4%B8%8E%E4%B8%8D%E5%8F%AF%E5%8F%98%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.3.1.</span> <span class="toc-text">可变类型与不可变类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%AF%E5%8F%98%E5%93%88%E5%B8%8C%E9%94%AE"><span class="toc-number">2.3.2.</span> <span class="toc-text">可变哈希键</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%99%84%E5%BD%95"><span class="toc-number">2.4.</span> <span class="toc-text">附录</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%93%88%E5%B8%8C%E8%A1%A8%E7%9A%84%E4%B8%80%E4%BA%9B%E5%9F%BA%E6%9C%AC%E5%A5%91%E7%BA%A6"><span class="toc-number">2.4.1.</span> <span class="toc-text">哈希表的一些基本契约</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%93%88%E5%B8%8C%E7%A0%81%E4%B8%80%E8%87%B4%E6%80%A7%EF%BC%88Hash-Code-Consistency%EF%BC%89"><span class="toc-number">2.4.1.1.</span> <span class="toc-text">哈希码一致性（Hash Code Consistency）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AD%89%E4%BB%B7%E6%80%A7%E5%AF%B9%E7%A7%B0%EF%BC%88Equivalence-Symmetry%EF%BC%89"><span class="toc-number">2.4.1.2.</span> <span class="toc-text">等价性对称（Equivalence Symmetry）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A9%BA%E9%94%AE%E5%A4%84%E7%90%86%EF%BC%88Null-Key-Handling%EF%BC%89"><span class="toc-number">2.4.1.3.</span> <span class="toc-text">空键处理（Null Key Handling）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%93%88%E5%B8%8C%E5%86%B2%E7%AA%81%E5%A4%84%E7%90%86%EF%BC%88Collision-Resolution%EF%BC%89"><span class="toc-number">2.4.1.4.</span> <span class="toc-text">哈希冲突处理（Collision Resolution）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%B6%E9%97%B4%E5%A4%8D%E6%9D%82%E6%80%A7%E4%BF%9D%E8%AF%81%EF%BC%88Time-Complexity%EF%BC%89"><span class="toc-number">2.4.1.5.</span> <span class="toc-text">时间复杂性保证（Time Complexity）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%8D%E5%8F%AF%E5%8F%98%E9%94%AE%E6%8E%A8%E8%8D%90%EF%BC%88Immutability-Recommendation%EF%BC%89"><span class="toc-number">2.4.1.6.</span> <span class="toc-text">不可变键推荐（Immutability Recommendation）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B4%9F%E8%BD%BD%E5%9B%A0%E6%95%B0%E7%BA%A6%E6%9D%9F%EF%BC%88Load-Factor-Control%EF%BC%89"><span class="toc-number">2.4.1.7.</span> <span class="toc-text">负载因数约束（Load Factor Control）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%9D%E5%8F%8D%E5%A5%91%E7%BA%A6%E7%9A%84%E5%85%B8%E5%9E%8B%E5%90%8E%E6%9E%9C"><span class="toc-number">2.4.1.8.</span> <span class="toc-text">违反契约的典型后果</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Java-%E7%9A%84-HashSet-%E5%AE%9E%E7%8E%B0"><span class="toc-number">2.4.2.</span> <span class="toc-text">Java 的 HashSet 实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#FAQ"><span class="toc-number">2.4.3.</span> <span class="toc-text">FAQ</span></a></li></ol></li></ol></li></ol></div></div></div></div></main><footer id="footer" style="background-image: url(/img/HashingPost/0.0.png);"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;2025 By WatsonthePeanut</span><span class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></span></div><div class="footer_custom_text">繋いでいこうね MY FUTURE。</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>(async () => {
  const showKatex = () => {
    document.querySelectorAll('#article-container .katex').forEach(el => el.classList.add('katex-show'))
  }

  if (!window.katex_js_css) {
    window.katex_js_css = true
    await btf.getCSS('https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css')
    if (false) {
      await btf.getScript('https://cdn.jsdelivr.net/npm/katex/dist/contrib/copy-tex.min.js')
    }
  }

  showKatex()
})()</script><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = null

  const getGiscusTheme = theme => theme === 'dark' ? 'transparent' : 'transparent'

  const createScriptElement = config => {
    const ele = document.createElement('script')
    Object.entries(config).forEach(([key, value]) => {
      ele.setAttribute(key, value)
    })
    return ele
  }

  const loadGiscus = (el = document, key) => {
    const mappingConfig = isShuoshuo
      ? { 'data-mapping': 'specific', 'data-term': key }
      : { 'data-mapping': (option && option['data-mapping']) || 'pathname' }

    const giscusConfig = {
      src: 'https://giscus.app/client.js',
      'data-repo': 'WatsonthePeanut/Giscus-blogcmt',
      'data-repo-id': 'R_kgDOOzHPtQ',
      'data-category-id': 'DIC_kwDOOzHPtc4Cqyrs',
      'data-theme': getGiscusTheme(document.documentElement.getAttribute('data-theme')),
      'data-reactions-enabled': '1',
      crossorigin: 'anonymous',
      async: true,
      ...option,
      ...mappingConfig
    }

    const scriptElement = createScriptElement(giscusConfig)

    el.querySelector('#giscus-wrap').appendChild(scriptElement)

    if (isShuoshuo) {
      window.shuoshuoComment.destroyGiscus = () => {
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }
  }

  const changeGiscusTheme = theme => {
    const iframe = document.querySelector('#giscus-wrap iframe')
    if (iframe) {
      const message = {
        giscus: {
          setConfig: {
            theme: getGiscusTheme(theme)
          }
        }
      }
      iframe.contentWindow.postMessage(message, 'https://giscus.app')
    }
  }

  btf.addGlobalFn('themeChange', changeGiscusTheme, 'giscus')

  if (isShuoshuo) {
    'Giscus' === 'Giscus'
      ? window.shuoshuoComment = { loadComment: loadGiscus }
      : window.loadOtherComment = loadGiscus
    return
  }

  if ('Giscus' === 'Giscus' || !false) {
    if (false) btf.loadComment(document.getElementById('giscus-wrap'), loadGiscus)
    else loadGiscus()
  } else {
    window.loadOtherComment = loadGiscus
  }
})()</script></div><script id="canvas_nest" defer="defer" color="255,255,255" opacity="1" zIndex="-1" count="150" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>